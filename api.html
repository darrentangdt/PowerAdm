<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<meta name="author" content="Kairo Araujo">
<META NAME="generator" CONTENT="http://txt2tags.org">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<LINK REL="stylesheet" TYPE="text/css" HREF="site.css">
<TITLE>PowerAdm - IBM Power/PowerVM Administration tool</TITLE>
<link rel="icon" type="image/png" href="/favicon.png">
</HEAD>
<BODY>

<DIV CLASS="header" ID="header">
<H1>PowerAdm - IBM Power/PowerVM Administration tool</H1>
<H3>PowerAdm API</H3>
</DIV>

<DIV CLASS="body" ID="body">
<div id="sidebar">
  <ul>
  <li id="home"><a href="./index.html">Home</a></li>
  <li id="requirements"><a href="./requirements.html">Requirements</a></li>
  <li id="screenshots"><a href="./screenshots.html">Deploy Screenshots</a></li>
  <li id="troubleshooting"><a href="./troubleshooting.html">Troubleshooting (Help)</a></li>
  <li id="tip-redeploy-os"><a href="./tip-redeploy-os.html">TIP Redeploy OS in LPAR</a></li>
  <li id="vcoforpoweradm"><a href="./vcoforpoweradm.html">vCO for PowerAdm</a></li>
  <li id="api"><a href="./api.html">API Document</a></li>
  <li id="releases"><a href="https://github.com/kairoaraujo/PowerAdm/releases">Download Releases</a></li>
  <li id="tarball"><a href="https://github.com/kairoaraujo/PowerAdm/tarball/master">Download TAR Ball</a></li>
  <li id="github"><a href="https://github.com/kairoaraujo/PowerAdm">Visit GitHub</a></li>
  </ul>
</div>
<P>
This document discribe abou the PowerAdm API and how to use that.
</P>
<P>
The API is located in <CODE>[ PowerAdm Home ]/poweradm/apimain.py</CODE> .
</P>

<HR NOSHADE SIZE=1>

<A NAME="toc1"></A>
<H2>How the API works</H2>

<P>
The principle of this API is based on <B>direct informations</B>, <B>array informations</B> 
and <B>actions</B>.
</P>
<P>
First you can see the help using <CODE>[ PowerAdm Home ]/poweradm/apimain.py -h</CODE>
</P>
<P>
<B>IMPORTANT</B>: The PowerAdm needs be installed and working!
</P>
<DIV CLASS="toc">

    <UL>
    <LI><A HREF="#toc1">How the API works</A>
    <LI><A HREF="#toc2">Direct informations</A>
    <LI><A HREF="#toc3">Array informations</A>
    <LI><A HREF="#toc4">Actions</A>
      <UL>
      <LI><A HREF="#toc5">-mklparcfg Create LPAR (and preview)</A>
      <LI><A HREF="#toc6">-nimosdeploy Deploy Operation System using NIM Server</A>
      </UL>
    </UL>

</DIV>

<A NAME="toc2"></A>
<H2>Direct informations</H2>

<P>
The direct information works with a simple output.
</P>
<P>
Example:
</P>
<P>
<CODE>-nimstatus</CODE> Return NIM enable status yes or no
</P>

<PRE>
[ PowerAdm Home ]/poweradm/apimain.py -nimstatus
yes
</PRE>

<P>
All direct informations contents in this API:
</P>

<PRE>
-nimstatus          Return NIM enable status [yes|no].
-sspstatus          Return Shared Storage Pool enable status [yes|no].
</PRE>

<A NAME="toc3"></A>
<H2>Array informations</H2>

<P>
To array informations we have two types of output.
</P>
<P>
First the size array and second you can use to get a specific information on array.
</P>
<P>
Example:
</P>
<P>
Getting the number size of the array with all pSystems available on the environment:
</P>
<P>
<CODE>-sn</CODE>                 List systems array size (number of systems).
</P>

<PRE>
[ PowerAdm Home ]/poweradm/apimain.py -sn
3
</PRE>

<P>
Getting the first position of this list with 3 systems.
</P>
<P>
Important: The array starts with 0!
</P>
<P>
<CODE>-sp [position]</CODE>          Print system position name in array.
</P>

<PRE>
[ PowerAdm Home ]/poweradm/apimain.py -sp 0
P1-8205-E6D-SN06A07BT
</PRE>

<P>
<B>How you can use that</B>
</P>
<P>
You can use tat with any language programming which have a simple loop like 'while'.
With array information you can construct drop downs, menus etc using all languages (PHP, 
JavaScript, Java etc)
</P>
<P>
Fist example with Shell Scripting:
</P>

<PRE>
#!/bin/sh

psystems=$([PowerAdm Home]/poweradm/apimain.py -sn)
count=0
while [ $count -lt $psystems ]
do
    echo $([PowerAdm Home]/poweradm/apimain.py -sp $count);
    let "count++";
done

</PRE>

<P>
The output
</P>

<PRE>
$ sh shell_sample.sh
P1-8205-E6D-SN06A07BT
P1-8205-E6D-SN06A07AT
P1-8205-E6D-SN06A07CT
</PRE>

<P>
Some options require the system name, this name is the pSystem name like on in the last example.
</P>
<P>
For example, to list informations about NPIV from the first NPIV VIOS you need use
<CODE>-npiv1 P1-8205-E6D-SN06A07AT</CODE> or to get the number of available FCs you need use
<CODE>-npiv1n P1-8205-E6D-SN06A07AT</CODE>.
</P>
<P>
All Array informations contents in this API:
</P>

<PRE>
Arguments:
-sn                         List systems array size (number of systems).
-sp [position]              Print system position name in array.
                            Position in array. Position start with 0. Use -sn to check array size.
-pooln                      List shared storage pools array size (number of shared storage pools).
-poolp [positon]            Print shared storage pool position name in array.
                            Position in array. Position start with 0. Use -pooln to check array size.
-vswn                       List Virtual Switches array size (number of virtual switches).
-vswp [postion]             Print virtual switch position name in array.
                            Position in array. Position start with 0. Use -vswn to check array size.
-npiv1 [system]             Print informations about NPIV (lsmap and notes) on Primary NPIV VIOS.
                            Requeries the name of system.
-npiv2 [system]             Print informations about NPIV (lsmap and notes) on Secondary NPIV VIOS.
                            Requeries the name of system.
-npiv1n [system]            List FCs array size (number of FCs available) on Primary NPIV VIOS.
                            Requeries the name of system
-npiv1p [system] [position] Print FC name in specific position
                            Requeries the name of system
                            Position start with 0. Use -npiv1n to check array size.
-npiv2n [system]            List FCs array size (number of FCs available) on Secondary NPIV VIOS.
                            Requeries the name of system.
-npiv2p [system] [position] List FCs array size (number of FCs available) on Secondary NPIV VIOS.
                            Requeries the name of system.
                            Position start with 0. Use -npiv2n to check array size.
-osn                        Get array size of available files/LPAR to NIM deploy.
-osp [position]             Print config deploy [position] in array.
                            Position in array. Position start with 0. Use -osn to check array size.
-osvn                       Get array size of available OS versions on NIM Deploy
-osvp [position]            Print OS NIM Deploys version in array. Use osvl to show number of OS version
-nimn                       Get array size of available NIM Servers
-nimp [position]            Print OS NIM Server in array.
                            Position in array. Position start with 0. Use -nimn to check array size.
</PRE>

<A NAME="toc4"></A>
<H2>Actions</H2>

<P>
With the actions you (at the version 0.10) you can create an LPAR (and preview) and deploy 
operation system on a prepared LPAR.
</P>

<A NAME="toc5"></A>
<H3>-mklparcfg Create LPAR (and preview)</H3>

<P>
Create LPAR (or only preview) on host server (pSystem)
</P>

<PRE>
[PowerAdm Home]/poweradm/apimain.py -mklparcfg change prefix lparname nim_deploy lparmem lparentcpu lparvcpu vscsi add_disk stgpool disk_size 
vfc npiv_vio1 npiv_vio2 vlan_deploy vsw_deploy net_vlan1 net_vlan2_1 net_vlan2_2 net_vlan3_1 net_vlan3_2 net_vlan3_3 
net_vsw1 net_vsw2_1 net_vsw2_2 net_vsw3_1 net_vsw3_2 net_vsw3_3 net_length system_option action
</PRE>

<P>
This action you can use to create LPAR. It need a lot of arguments but you can get using API. 
</P>
<P>
In the order they are:
</P>

<TABLE>
<TR>
<TD>change</TD>
<TD>Change/Ticket (or some title) can't use space</TD>
</TR>
<TR>
<TD>prefix</TD>
<TD>Prefix name for LPAR (like DEV, QAS, PRD) PREFIX-lparname</TD>
</TR>
<TR>
<TD>lparname</TD>
<TD>The LPAR name.</TD>
</TR>
<TR>
<TD>nim_deploy</TD>
<TD>[y/n] Prepare the LPAR to NIM OS Deploy?</TD>
</TR>
<TR>
<TD>lparmem</TD>
<TD>The memory size for LPAR. Only the numbers. Example to 10GB: 10</TD>
</TR>
<TR>
<TD>lparentcpu</TD>
<TD>The LPAR entitled CPU. Float number only: Ex: 0.8 or 1.5</TD>
</TR>
<TR>
<TD>lparvcpu</TD>
<TD>The LPAR virtual CPU. Ex: 6 or 3</TD>
</TR>
<TR>
<TD>vscsi</TD>
<TD>[y/n] Create a Virtual SCSI?</TD>
</TR>
<TR>
<TD>add_disk</TD>
<TD>[y/n] Add Disk using Shared Storage Pool?</TD>
</TR>
<TR>
<TD>stgpool</TD>
<TD>The Storage Pool name ( the add_disk and vscsi need by 'y'. 'false' if you can't use.</TD>
</TR>
<TR>
<TD>disk_size</TD>
<TD>Disk Size only the numbers in GB. Example to 50GB: 50 . 0 if 'add_disk' is 'n'</TD>
</TR>
<TR>
<TD>vfc</TD>
<TD>Create virtual Fiber Channel (NPIV) on LPAR?</TD>
</TR>
<TR>
<TD>npiv_vio1</TD>
<TD>The physical FC from VIOS NPIV #1</TD>
</TR>
<TR>
<TD>npiv_vio2</TD>
<TD>The physical FC from VIOS NPIV #2</TD>
</TR>
<TR>
<TD>vlan_deploy</TD>
<TD>If nim_deploy is 'y' put here the number of VLAN to deploy using NIM. Example: 700. If nim_deploy is 'y' put here 'null'</TD>
</TR>
<TR>
<TD>vsw_deploy</TD>
<TD>If nim_deploy is 'y' put here the Virtual Switch used to deploy. If nim_deploy is 'n' put 'null'</TD>
</TR>
<TR>
<TD>net_vlan1</TD>
<TD>The VLAN of the first Ethernet if you are using only one Ethernet. If you want create 2 or 3 Ethernets put '0' here. Use numbers only!</TD>
</TR>
<TR>
<TD>net_vlan2_1</TD>
<TD>The VLAN of the first Ethernet if you are using two Ethernets. If you want create 1 or 3 Ethernets put '0' here. Use numbers only!</TD>
</TR>
<TR>
<TD>net_vlan2_2</TD>
<TD>The VLAN of the Second Ethernet if you are using two Ethernets. If you want create 1 or 3 Ethernets put '0' here. Use numbers only!</TD>
</TR>
<TR>
<TD>net_vlan3_1</TD>
<TD>The VLAN of the first Ethernet if you are using three Ethernets. If you want create 2 or 3 Ethernets put '0' here. Use numbers only!</TD>
</TR>
<TR>
<TD>net_vlan3_2</TD>
<TD>The VLAN of the second Ethernet if you are using three Ethernets. If you want create 2 or 3 Ethernets put '0' here. Use numbers only!</TD>
</TR>
<TR>
<TD>net_vlan3_3</TD>
<TD>The VLAN of the third Ethernet if you are using three Ethernets. If you want create 2 or 3 Ethernets put '0' here. Use numbers only!</TD>
</TR>
<TR>
<TD>net_vsw1</TD>
<TD>The Virtual Switch of the first Ethernet if you are using only one Ethernet. If you want create 2 or 3 Ethernets put 'null' here.</TD>
</TR>
<TR>
<TD>net_vsw2_1</TD>
<TD>The Virtual Switch of the first Ethernet if you are using two Ethernets. If you want create 1 or 3 Ethernets put 'null' here.</TD>
</TR>
<TR>
<TD>net_vsw2_2</TD>
<TD>The Virtual Switch of the Second Ethernet if you are using two Ethernets. If you want create 1 or 3 Ethernets put 'null' here.</TD>
</TR>
<TR>
<TD>net_vsw3_1</TD>
<TD>The Virtual Switch of the first Ethernet if you are using three Ethernets. If you want create 2 or 3 Ethernets put 'null' here.</TD>
</TR>
<TR>
<TD>net_vsw3_2</TD>
<TD>The Virtual Switch of the second Ethernet if you are using three Ethernets. If you want create 2 or 3 Ethernets put 'null' here.</TD>
</TR>
<TR>
<TD>net_vsw3_3</TD>
<TD>The Virtual Switch of the hird Ethernet if you are using three Ethernets. If you want create 2 or 3 Ethernets put 'null' here.</TD>
</TR>
<TR>
<TD>net_length</TD>
<TD>[1/2/3] The number of ethernet</TD>
</TR>
<TR>
<TD>system_option</TD>
<TD>The pSystem host server. The name of pSystem like P1-8205-E6D-SN06A07AT</TD>
</TR>
<TR>
<TD>action</TD>
<TD>[preview/create] The final action. 'preview' print only a config list and 'create' make the LPAR</TD>
</TR>
</TABLE>

<P>
Example:
</P>

<PRE>
[ PowerAdm Home ]/poweradm/apimain.py -mklparcfg TICKET0020 DEV TESTSRV y 10 0.2 2 false false null true 0 fcs4 fcs5 700 VSW-DATA 2323 2323 null 2323 null null VSW-DATA null null null null null 1 P1-8205-E6D-SN06A07AT preview
The parameters send is:
Change: TICKET0020
Prefix: DEV
LPAR Name: TESTSRV
NIM Deploy: y
LPAR Memory: 10
LPAR Entitled CPU: 0.2
LPAR Virtual CPU: 2
Virtual SCSI: false
Add Disk: false
Storage Pool: null
Disk Size: true
Virtual HBA: 0
NPIV VIO1: fcs4
NPIV VIO2: fcs5
VLAN Deploy: 700
Virtual Switch Deploy: VSW-DATA
Ethernet if number of ethernets is 1

Virtual VLAN Ethernet  1 of 1: 2323
Virtual Virtual Switch 1 of 1: VSW-DATA

Ethernets if number of ethernets is 2
Virtual VLAN Ethernet  1 of 2: 2323
Virtual Virtual Switch 1 of 2: null
Virtual VLAN Ethernet  2 of 2: null
Virtual Virtual Switch 2 of 2: null

Ethernets if number of ethernets is 3
Virtual VLAN Ethernet  1 of 3: 2323
Virtual Virtual Switch 1 of 3: null
Virtual VLAN Ethernet  2 of 3: null
Virtual Virtual Switch 2 of 3: null
Virtual VLAN Ethernet  3 of 3: null
Virtual Virtual Switch 2 of 3: null

Number of Ethernets: 1
System host: P1-8205-E6D-SN06A07AT
Action: preview

********************************************************************************
Config validation:

Change/Ticket: TICKET0020
LPAR: DEV-TESTSRV
LPAR ID: 48
Deploy via NIM: y
LPAR Memory: 10
LPAR Entitled CPU: 0.2
LPAR Virtual CPU: 2
Virtual SCSI: n
Add Disk: n
Storage Pool: none
Disk Size: true
Virtual HBA/NPIV: n
NPIV 1: fcs4
NPIV 2: fcs5
Ethernet temporaly: 10/0/700//0/0/VSW-DATA
Ethernet final: 10/0/2323//0/0/VSW-DATA
Host System: P1-8205-E6D-SN06A07AT
Primary:     VIOS1
Secondary:   VIOS2

********************************************************************************
</PRE>

<A NAME="toc6"></A>
<H3>-nimosdeploy Deploy Operation System using NIM Server</H3>

<P>
Deploy operation system using NIM Server
</P>

<PRE>
apimain.py -nimosdeploy nim_file os_version nim_server y|n
</PRE>

<P>
This action you can use to create LPAR. It need a lot of arguments but you can get using API. 
</P>

<TABLE>
<TR>
<TD>nim_file</TD>
<TD>The file of machin .nim used by PowerAdm</TD>
<TD>use -osn and -osnp or ls -la [ PowerAdm Home ]/poweradm/nim/</TD>
</TR>
<TR>
<TD>os_version</TD>
<TD>The NIM OS Version</TD>
<TD>use -osvn and -osvp or in config</TD>
</TR>
<TR>
<TD>nim_server</TD>
<TD>The nimserver to use</TD>
<TD>use -nimn and -nimp or in config</TD>
</TR>
<TR>
<TD>y|n</TD>
<TD>'y' to deploy and 'n' to preview</TD>
</TR>
</TABLE>

<P>
Example:
</P>

<PRE>
[PowerAdm Home]/poweradm/apimain.py -nimdeploy DEV-TESTSRV.nim 'AIX 7.1 TL03 SP04' NIMSERVER n
Config verification:

LPAR Prefix: DEV
LPAR Name: TESTSRV
LPAR Frame: P1-8205-E6D-SN06A07AT
LPAR Finale VLAN: 10/0/2323//0/0/VSW-DATA
LPAR NIM File: [PowerAdm Home]poweradm/nim/DEV-TESTSRV.nim
NIM config OS Version: AIX 7.1 TL03 SP04
NIM config OS spot: SPOT_AIX71_TL03_SP04
NIM config OS mksysb/spot: MKSYSB_AIX71_TL03_SP04
NIM IP Address: 10.0.0.1
NIM start IP of range: 11
NIM end IP of range: 253
NIM IP Network: 10.0.0.
NIM Server: NIMSERVER1
NIM IP Deploy (server): 10.0.0.1
Deploy: n
</PRE>

</div><div id="footer">
<P>
<IMG ALIGN="middle" SRC="./img/t2tpowered-white.png" BORDER="0" ALT="">
</P>
<P>
Last modified on 15 July 2015 at 16:39
(<A HREF="api.t2t">See sources</A>)
</P>
</div><div id="fake">
<!-- Google Analytics code -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-280222-14']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</DIV>

<!-- html code generated by txt2tags 2.6 (http://txt2tags.org) -->
<!-- cmdline: txt2tags -t html -\-toc api.t2t -->
</BODY></HTML>
